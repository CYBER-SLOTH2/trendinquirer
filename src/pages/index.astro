---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Socials from "@/components/Socials.astro";
import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import IconRss from "@/assets/icons/IconRss.svg";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import { SITE } from "@/config";
import { SOCIALS } from "@/constants";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<Layout>
  <Header />

  <main id="main-content" data-layout="index" class="app-layout">

    <!-- HERO / SITE INTRO -->
    <section id="hero" class="pt-8 pb-10 border-b border-border">
      <div class="max-w-3xl">
        <h1 class="my-4 text-4xl font-bold leading-tight sm:my-8 sm:text-5xl">
          Trend Inquirer — Research-Backed Insights on What’s Trending
        </h1>

        <p class="mt-4 text-lg text-muted-foreground">
          Trend Inquirer is an independent digital publication covering emerging
          trends in technology, finance, artificial intelligence, digital culture,
          and modern lifestyle — explained clearly and responsibly.
        </p>

        <p class="mt-3">
          We focus on <strong>clarity, accuracy, and usefulness</strong>, helping
          readers understand what’s changing, why it matters, and what to expect next.
        </p>

        <div class="mt-5 flex flex-wrap items-center gap-4">
          <LinkButton href="/posts/" class="font-semibold">
            Explore Latest Articles
            <IconArrowRight class="inline-block rtl:-rotate-180" />
          </LinkButton>

          <LinkButton
            href="/about"
            class="underline decoration-dashed underline-offset-4 hover:text-accent"
          >
            About Trend Inquirer
          </LinkButton>

          <a
            href="/rss.xml"
            target="_blank"
            class="inline-flex items-center gap-1 text-sm hover:text-accent"
            aria-label="RSS Feed"
          >
            <IconRss width={18} height={18} class="stroke-accent stroke-3" />
            RSS
          </a>
        </div>

        {
          SOCIALS.length > 0 && (
            <div class="mt-6 flex max-sm:flex-col sm:items-center">
              <span class="me-2 text-sm font-medium">Follow:</span>
              <Socials />
            </div>
          )
        }
      </div>
    </section>

    <!-- FEATURED POSTS -->
    {
      featuredPosts.length > 0 && (
        <section
          id="featured"
          class:list={[
            "pt-12 pb-6",
            { "border-b border-border": recentPosts.length > 0 },
          ]}
        >
          <h2 class="text-2xl font-semibold tracking-wide">
            Featured Articles
          </h2>

          <ul class="mt-6 grid gap-6">
            {featuredPosts.map(post => (
              <Card variant="h3" {...post} />
            ))}
          </ul>
        </section>
      )
    }

    <!-- RECENT POSTS -->
    {
      recentPosts.length > 0 && (
        <section id="recent-posts" class="pt-12 pb-6">
          <h2 class="text-2xl font-semibold tracking-wide">
            Latest Posts
          </h2>

          <ul class="mt-6 grid gap-6">
            {recentPosts.map(
              (post, index) =>
                index < SITE.postPerIndex && (
                  <Card variant="h3" {...post} />
                )
            )}
          </ul>
        </section>
      )
    }

    <!-- EDITORIAL TRUST / E-E-A-T -->
    <section
      id="editorial-trust"
      class="pt-12 pb-6 border-t border-border"
    >
      <div class="max-w-3xl">
        <h2 class="text-2xl font-semibold tracking-wide">
          Editorial Integrity & Transparency
        </h2>

        <p class="mt-4">
          All content published on Trend Inquirer follows a research-first editorial
          process. Articles are written by human editors with AI-assisted research,
          reviewed for originality, accuracy, and clarity before publication.
        </p>

        <ul class="mt-4 list-disc ps-5 space-y-1">
          <li>Original, non-plagiarized content</li>
          <li>Clear distinction between facts and opinions</li>
          <li>Credible sources and references</li>
          <li>Monetization aligned with Google AdSense policies</li>
        </ul>

        <p class="mt-4 text-sm text-muted-foreground">
          Learn more on our{" "}
          <a
            href="/about"
            class="underline decoration-dashed underline-offset-4 hover:text-accent"
          >
            About page
          </a>.
        </p>
      </div>
    </section>

    <!-- ALL POSTS CTA -->
    <div class="my-10 text-center">
      <LinkButton href="/posts/" class="font-semibold">
        View All Articles
        <IconArrowRight class="inline-block rtl:-rotate-180" />
      </LinkButton>
    </div>

  </main>

  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = document.querySelector("#main-content")?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }
  });
</script>
